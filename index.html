<!DOCTYPE html>
<html lang="ru" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Путь к Рамадану - Ваш духовный спутник</title>
    <meta name="description" content="Подготовка к Рамадану 2026 - Коран, намаз, азкары, трекер привычек">
    <meta name="theme-color" content="#0B5B3F"/>
    
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="./manifest.json">
    <link rel="icon" type="image/png" href="icons/icon-192.png">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Amiri+Quran&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Lateef&display=swap" rel="stylesheet">
    
    <style>
        /* === CSS Variables === */
        :root {
            --primary-dark: #0B5B3F;
            --primary-main: #1C7A5C;
            --primary-light: #2A9D75;
            --accent-gold: #D9B44A;
            --accent-cream: #F6E8C3;
            --bg-light: #FAFAF8;
            --bg-card-light: #FFFFFF;
            --text-primary-light: #1A1A1A;
            --text-secondary-light: #666666;
            --border-light: #E8E8E8;
            --bg-dark: #0E1116;
            --bg-card-dark: #1A1D24;
            --text-primary-dark: #F0F0F0;
            --text-secondary-dark: #A0A0A0;
            --border-dark: #2D3748;
            --success: #10B981;
            --warning: #F59E0B;
            --error: #EF4444;
            --radius-lg: 20px;
            --radius-md: 12px;
            --radius-sm: 8px;
            --shadow-sm: 0 2px 8px rgba(11, 91, 63, 0.08);
            --shadow-md: 0 4px 20px rgba(11, 91, 63, 0.12);
            --shadow-lg: 0 8px 32px rgba(11, 91, 63, 0.15);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            
            /* Quran font sizes */
            --arabic-font-size: 2rem;
            --translation-font-size: 1rem;
        }

        /* === Base Styles === */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        html, body {
            height: 100%;
            width: 100%;
            overflow: hidden;
            position: fixed;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--bg-light);
            color: var(--text-primary-light);
            line-height: 1.6;
            min-height: 100vh;
            transition: var(--transition);
            overflow: hidden;
            -webkit-overflow-scrolling: touch;
            position: relative;
            touch-action: pan-y;
        }

        body.dark-theme {
            background-color: var(--bg-dark);
            color: var(--text-primary-dark);
        }

        .app-container {
            max-width: 480px;
            margin: 0 auto;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
            background: var(--bg-light);
        }

        body.dark-theme .app-container {
            background: var(--bg-dark);
        }

        /* === Tab Content === */
        .tab-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding-bottom: 80px;
            display: none;
            -webkit-overflow-scrolling: touch;
            height: calc(100vh - 80px);
            position: relative;
        }

        .tab-content.active {
            display: block;
        }

        /* Фикс для PWA прокрутки */
        .tab-content::-webkit-scrollbar {
            display: none;
        }

        .tab-content {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* === Header === */
        .header {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-main));
            color: white;
            padding: 1.5rem 1.25rem;
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 120px;
            height: 120px;
            background: radial-gradient(circle, rgba(217, 180, 74, 0.1) 0%, transparent 70%);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--accent-gold), #F6E8C3);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
        }

        .logo-text {
            font-size: 1.4rem;
            font-weight: 700;
        }

        .theme-toggle {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            backdrop-filter: blur(10px);
            touch-action: manipulation;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .countdown-section {
            text-align: center;
        }

        .countdown-title {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .countdown-timer {
            font-size: 2.8rem;
            font-weight: 700;
            letter-spacing: 2px;
            font-feature-settings: "tnum";
            margin-bottom: 0.25rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .countdown-subtitle {
            font-size: 0.85rem;
            opacity: 0.8;
        }

        /* === Progress Section === */
        .progress-section {
            padding: 1.5rem 1.25rem;
            background: var(--bg-card-light);
            margin: 0.75rem;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
        }

        body.dark-theme .progress-section {
            background: var(--bg-card-dark);
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .progress-label {
            font-size: 1rem;
            font-weight: 600;
            color: var(--primary-dark);
        }

        body.dark-theme .progress-label {
            color: var(--accent-gold);
        }

        .progress-percent {
            font-size: 1rem;
            font-weight: 700;
            color: var(--primary-dark);
        }

        body.dark-theme .progress-percent {
            color: var(--accent-gold);
        }

        .progress-bar {
            height: 12px;
            background-color: var(--bg-light);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        body.dark-theme .progress-bar {
            background-color: var(--border-dark);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-main), var(--accent-gold));
            border-radius: 10px;
            width: 0%;
            transition: width 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        /* === Today's Task === */
        .task-card {
            background: var(--bg-card-light);
            margin: 0.75rem;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            overflow: hidden;
            transition: var(--transition);
        }

        body.dark-theme .task-card {
            background: var(--bg-card-dark);
        }

        .task-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .task-header {
            padding: 1.25rem 1.25rem 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .task-badge {
            background: linear-gradient(135deg, var(--accent-gold), #e6a429);
            color: white;
            font-size: 0.75rem;
            padding: 0.4rem 1rem;
            border-radius: 20px;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .task-date {
            font-size: 0.8rem;
            color: var(--text-secondary-light);
            font-weight: 500;
        }

        body.dark-theme .task-date {
            color: var(--text-secondary-dark);
        }

        .task-content {
            padding: 1.25rem;
        }

        .task-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 0.75rem;
            color: var(--text-primary-light);
            line-height: 1.4;
        }

        body.dark-theme .task-title {
            color: var(--text-primary-dark);
        }

        .task-description {
            color: var(--text-secondary-light);
            margin-bottom: 1.5rem;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        body.dark-theme .task-description {
            color: var(--text-secondary-dark);
        }

        .task-proof {
            background: linear-gradient(135deg, rgba(11, 91, 63, 0.05), rgba(217, 180, 74, 0.05));
            border-radius: var(--radius-md);
            padding: 1.25rem;
            margin-bottom: 1.5rem;
            border-left: 4px solid var(--primary-main);
            font-style: italic;
            line-height: 1.6;
        }

        body.dark-theme .task-proof {
            background: linear-gradient(135deg, rgba(11, 91, 63, 0.15), rgba(217, 180, 74, 0.1));
        }

        .task-source {
            display: block;
            text-align: right;
            font-size: 0.8rem;
            margin-top: 0.75rem;
            opacity: 0.7;
            font-style: normal;
            font-weight: 500;
        }

        .task-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 1rem;
            border-top: 1px solid var(--border-light);
        }

        body.dark-theme .task-actions {
            border-top-color: var(--border-dark);
        }

        .task-checkbox {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            touch-action: manipulation;
        }

        .checkbox {
            width: 28px;
            height: 28px;
            border: 2px solid var(--primary-main);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            position: relative;
        }

        .checkbox.checked {
            background: var(--primary-main);
            border-color: var(--primary-main);
        }

        .checkbox.checked::after {
            content: '✓';
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .checkbox-label {
            font-weight: 600;
            color: var(--text-primary-light);
        }

        body.dark-theme .checkbox-label {
            color: var(--text-primary-dark);
        }

        .task-meta {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 0.8rem;
            color: var(--text-secondary-light);
        }

        body.dark-theme .task-meta {
            color: var(--text-secondary-dark);
        }

        .task-time, .task-difficulty {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        /* === Quick Actions === */
        .quick-actions {
            padding: 1rem 0.75rem;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.75rem;
        }

        .action-button {
            background: var(--bg-card-light);
            border: none;
            border-radius: var(--radius-lg);
            padding: 1.25rem 0.5rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.75rem;
            box-shadow: var(--shadow-sm);
            touch-action: manipulation;
        }

        body.dark-theme .action-button {
            background: var(--bg-card-dark);
        }

        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .action-button.active {
            background: linear-gradient(135deg, var(--primary-main), var(--primary-dark));
            color: white;
        }

        .action-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--primary-main), var(--primary-dark));
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: var(--transition);
        }

        .action-button.active .action-icon {
            background: rgba(255, 255, 255, 0.2);
        }

        .action-text {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-primary-light);
        }

        body.dark-theme .action-text {
            color: var(--text-primary-dark);
        }

        .action-button.active .action-text {
            color: white;
        }

        /* === Daily Verse === */
        .verse-card {
            background: linear-gradient(135deg, var(--accent-cream), #f0e6d1);
            margin: 0.75rem;
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }

        body.dark-theme .verse-card {
            background: linear-gradient(135deg, #2d2a1a, #3a3520);
        }

        .verse-card::before {
            content: """;
            position: absolute;
            top: -10px;
            right: 15px;
            font-size: 120px;
            color: rgba(11, 91, 63, 0.1);
            font-family: serif;
            line-height: 1;
        }

        body.dark-theme .verse-card::before {
            color: rgba(217, 180, 74, 0.1);
        }

        .verse-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .verse-title {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--primary-dark);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        body.dark-theme .verse-title {
            color: var(--accent-gold);
        }

        .verse-bookmark {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            opacity: 0.7;
            transition: var(--transition);
            touch-action: manipulation;
        }

        .verse-bookmark:hover {
            opacity: 1;
            transform: scale(1.1);
        }

        .verse-arabic {
            font-family: 'Lateef', serif;
            font-size: var(--arabic-font-size);
            text-align: right;
            line-height: 2;
            margin-bottom: 1.25rem;
            direction: rtl;
            font-weight: 500;
            letter-spacing: 1px;
            word-spacing: 3px;
        }

        .verse-translation {
            font-style: italic;
            margin-bottom: 1rem;
            line-height: 1.6;
            color: var(--text-primary-light);
            font-size: var(--translation-font-size);
        }

        body.dark-theme .verse-translation {
            color: var(--text-primary-dark);
        }

        .verse-source {
            text-align: right;
            font-size: 0.8rem;
            opacity: 0.7;
            font-weight: 500;
        }

        /* === Preparation Tab === */
        .week-section {
            margin: 0.75rem;
        }

        .week-card {
            background: var(--bg-card-light);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: var(--shadow-sm);
            border-left: 4px solid var(--primary-main);
        }

        body.dark-theme .week-card {
            background: var(--bg-card-dark);
        }

        .week-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .week-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary-dark);
        }

        body.dark-theme .week-title {
            color: var(--accent-gold);
        }

        .week-progress {
            font-size: 0.8rem;
            color: var(--text-secondary-light);
            font-weight: 500;
        }

        body.dark-theme .week-progress {
            color: var(--text-secondary-dark);
        }

        .week-theme {
            color: var(--text-secondary-light);
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        body.dark-theme .week-theme {
            color: var(--text-secondary-dark);
        }

        .tasks-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .task-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: var(--bg-light);
            border-radius: var(--radius-md);
            transition: var(--transition);
            cursor: pointer;
            touch-action: manipulation;
        }

        body.dark-theme .task-item {
            background: var(--border-dark);
        }

        .task-item.completed {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(11, 91, 63, 0.05));
        }

        .task-item-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid var(--primary-main);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            flex-shrink: 0;
        }

        .task-item.completed .task-item-checkbox {
            background: var(--success);
            border-color: var(--success);
        }

        .task-item.completed .task-item-checkbox::after {
            content: '✓';
            color: white;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .task-item-text {
            flex: 1;
            font-size: 0.9rem;
        }

        .task-item.completed .task-item-text {
            text-decoration: line-through;
            opacity: 0.7;
        }

        /* === Quran Tab === */
        .quran-section {
            padding: 1rem 0.75rem;
        }

        .surah-card {
            background: var(--bg-card-light);
            border-radius: var(--radius-lg);
            padding: 1.25rem;
            margin-bottom: 0.75rem;
            box-shadow: var(--shadow-sm);
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: var(--transition);
            cursor: pointer;
            touch-action: manipulation;
            position: relative;
        }

        body.dark-theme .surah-card {
            background: var(--bg-card-dark);
        }

        .surah-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .surah-number {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary-main), var(--primary-dark));
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .surah-info {
            flex: 1;
        }

        .surah-name {
            font-weight: 700;
            margin-bottom: 0.25rem;
            color: var(--text-primary-light);
        }

        body.dark-theme .surah-name {
            color: var(--text-primary-dark);
        }

        .surah-details {
            font-size: 0.8rem;
            color: var(--text-secondary-light);
        }

        body.dark-theme .surah-details {
            color: var(--text-secondary-dark);
        }

        .surah-actions {
            display: flex;
            gap: 0.5rem;
        }

        .surah-action-btn {
            background: var(--bg-light);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            touch-action: manipulation;
        }

        body.dark-theme .surah-action-btn {
            background: var(--border-dark);
        }

        /* === Prayer Tab === */
        .prayer-section {
            padding: 1rem 0.75rem;
        }

        .prayer-times {
            background: var(--bg-card-light);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: var(--shadow-sm);
        }

        body.dark-theme .prayer-times {
            background: var(--bg-card-dark);
        }

        .prayer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .prayer-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary-dark);
        }

        body.dark-theme .prayer-title {
            color: var(--accent-gold);
        }

        .prayer-location {
            font-size: 0.8rem;
            color: var(--text-secondary-light);
        }

        body.dark-theme .prayer-location {
            color: var(--text-secondary-dark);
        }

        .prayer-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .prayer-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background: var(--bg-light);
            border-radius: var(--radius-md);
            transition: var(--transition);
        }

        body.dark-theme .prayer-item {
            background: var(--border-dark);
        }

        .prayer-item.active {
            background: linear-gradient(135deg, rgba(11, 91, 63, 0.1), rgba(217, 180, 74, 0.05));
            border-left: 4px solid var(--primary-main);
        }

        .prayer-name {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .prayer-time {
            font-weight: 700;
            color: var(--primary-dark);
        }

        body.dark-theme .prayer-time {
            color: var(--accent-gold);
        }

        .prayer-completed {
            color: var(--success);
            font-weight: 700;
        }

        /* === Community Tab === */
        .community-section {
            padding: 1rem 0.75rem;
        }

        .community-card {
            background: var(--bg-card-light);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: var(--shadow-sm);
        }

        body.dark-theme .community-card {
            background: var(--bg-card-dark);
        }

        .community-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--primary-dark);
        }

        body.dark-theme .community-title {
            color: var(--accent-gold);
        }

        .community-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .community-stat {
            text-align: center;
            padding: 1rem;
            background: var(--bg-light);
            border-radius: var(--radius-md);
        }

        body.dark-theme .community-stat {
            background: var(--border-dark);
        }

        .community-stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-dark);
            margin-bottom: 0.25rem;
        }

        body.dark-theme .community-stat-value {
            color: var(--accent-gold);
        }

        .community-stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary-light);
        }

        body.dark-theme .community-stat-label {
            color: var(--text-secondary-dark);
        }

        .community-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }

        .community-button {
            background: var(--primary-main);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            padding: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            touch-action: manipulation;
        }

        .community-button:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        /* === Dua Tab === */
        .dua-section {
            padding: 1rem 0.75rem;
        }

        .dua-category {
            margin-bottom: 1.5rem;
        }

        .category-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--primary-dark);
            padding-left: 0.5rem;
            border-left: 4px solid var(--accent-gold);
        }

        body.dark-theme .category-title {
            color: var(--accent-gold);
        }

        .dua-card {
            background: var(--bg-card-light);
            border-radius: var(--radius-lg);
            padding: 1.25rem;
            margin-bottom: 0.75rem;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
        }

        body.dark-theme .dua-card {
            background: var(--bg-card-dark);
        }

        .dua-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .dua-arabic {
            font-family: 'Lateef', serif;
            font-size: var(--arabic-font-size);
            text-align: right;
            line-height: 1.8;
            margin-bottom: 1rem;
            direction: rtl;
            letter-spacing: 1px;
            word-spacing: 3px;
        }

        .dua-translation {
            font-style: italic;
            margin-bottom: 0.75rem;
            color: var(--text-secondary-light);
            line-height: 1.6;
            font-size: var(--translation-font-size);
        }

        body.dark-theme .dua-translation {
            color: var(--text-secondary-dark);
        }

        .dua-source {
            font-size: 0.8rem;
            opacity: 0.7;
            text-align: right;
        }

        /* === Profile Tab === */
        .profile-section {
            padding: 1rem 0.75rem;
        }

        .profile-card {
            background: var(--bg-card-light);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: var(--shadow-sm);
            text-align: center;
        }

        body.dark-theme .profile-card {
            background: var(--bg-card-dark);
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary-main), var(--accent-gold));
            border-radius: 50%;
            margin: 0 auto 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
        }

        .profile-name {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .profile-level {
            color: var(--text-secondary-light);
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        body.dark-theme .profile-level {
            color: var(--text-secondary-dark);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-dark);
            margin-bottom: 0.25rem;
        }

        body.dark-theme .stat-value {
            color: var(--accent-gold);
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary-light);
        }

        body.dark-theme .stat-label {
            color: var(--text-secondary-dark);
        }

        .settings-section {
            background: var(--bg-card-light);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow-sm);
        }

        body.dark-theme .settings-section {
            background: var(--bg-card-dark);
        }

        .settings-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--primary-dark);
        }

        body.dark-theme .settings-title {
            color: var(--accent-gold);
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid var(--border-light);
        }

        body.dark-theme .setting-item {
            border-bottom-color: var(--border-dark);
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-label {
            font-weight: 500;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary-main);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* === Bottom Navigation === */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-card-light);
            display: flex;
            justify-content: space-around;
            padding: 0.75rem 0;
            border-top: 1px solid var(--border-light);
            backdrop-filter: blur(10px);
            z-index: 1000;
            max-width: 480px;
            margin: 0 auto;
        }

        body.dark-theme .bottom-nav {
            background: var(--bg-card-dark);
            border-top-color: var(--border-dark);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
            cursor: pointer;
            opacity: 0.6;
            transition: var(--transition);
            flex: 1;
            padding: 0.5rem;
            border-radius: var(--radius-md);
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .nav-item.active {
            opacity: 1;
            background: linear-gradient(135deg, rgba(11, 91, 63, 0.1), rgba(217, 180, 74, 0.05));
        }

        body.dark-theme .nav-item.active {
            background: linear-gradient(135deg, rgba(11, 91, 63, 0.2), rgba(217, 180, 74, 0.1));
        }

        .nav-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            transition: var(--transition);
        }

        .nav-item.active .nav-icon {
            transform: scale(1.1);
        }

        .nav-text {
            font-size: 0.7rem;
            font-weight: 600;
            transition: var(--transition);
        }

        .nav-item.active .nav-text {
            color: var(--primary-main);
        }

        body.dark-theme .nav-item.active .nav-text {
            color: var(--accent-gold);
        }

        /* === Responsive Design === */
        @media (max-width: 380px) {
            .app-container {
                padding: 0;
            }
            
            .countdown-timer {
                font-size: 2.2rem;
            }
            
            .quick-actions {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.5rem;
            }
            
            .action-button {
                padding: 1rem 0.25rem;
            }
        }

        @media (min-width: 768px) {
            .app-container {
                max-width: 800px;
                border-left: 1px solid var(--border-light);
                border-right: 1px solid var(--border-light);
            }
            
            body.dark-theme .app-container {
                border-left-color: var(--border-dark);
                border-right-color: var(--border-dark);
            }
        }

        /* === Utility Classes === */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* === Loading States === */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.6; }
            100% { opacity: 1; }
        }

        /* === Modal Styles === */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-card-light);
            border-radius: var(--radius-lg);
            padding: 2rem;
            max-width: 90%;
            max-height: 80%;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            -webkit-overflow-scrolling: touch;
        }

        body.dark-theme .modal-content {
            background: var(--bg-card-dark);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary-dark);
        }

        body.dark-theme .modal-title {
            color: var(--accent-gold);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary-light);
            touch-action: manipulation;
        }

        body.dark-theme .modal-close {
            color: var(--text-secondary-dark);
        }

        .surah-content {
            text-align: right;
            direction: rtl;
            font-family: 'Lateef', serif;
            font-size: var(--arabic-font-size);
            line-height: 2.5;
            margin-bottom: 1.5rem;
            -webkit-overflow-scrolling: touch;
            letter-spacing: 1px;
            word-spacing: 3px;
        }

        .ayah-container {
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-light);
            padding-bottom: 1rem;
        }

        body.dark-theme .ayah-container {
            border-bottom-color: var(--border-dark);
        }

        .ayah-arabic {
            font-family: 'Lateef', serif;
            font-size: var(--arabic-font-size);
            line-height: 2;
            margin-bottom: 0.5rem;
            text-align: right;
            letter-spacing: 1px;
            word-spacing: 3px;
            cursor: pointer;
            transition: var(--transition);
            padding: 0.5rem;
            border-radius: var(--radius-sm);
        }

        .ayah-arabic:hover {
            background: rgba(11, 91, 63, 0.05);
        }

        body.dark-theme .ayah-arabic:hover {
            background: rgba(217, 180, 74, 0.05);
        }

        .ayah-translation {
            font-style: italic;
            line-height: 1.6;
            color: var(--text-secondary-light);
            margin-bottom: 0.5rem;
            font-size: var(--translation-font-size);
        }

        body.dark-theme .ayah-translation {
            color: var(--text-secondary-dark);
        }

        .ayah-number {
            display: inline-block;
            background: var(--primary-main);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            text-align: center;
            font-size: 0.8rem;
            line-height: 24px;
            margin-left: 0.5rem;
        }

        .surah-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 1.5rem;
        }

        .nav-button {
            background: var(--primary-main);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            touch-action: manipulation;
        }

        .nav-button:hover {
            background: var(--primary-dark);
        }

        .nav-button:disabled {
            background: var(--text-secondary-light);
            cursor: not-allowed;
        }

        body.dark-theme .nav-button:disabled {
            background: var(--text-secondary-dark);
        }

        /* === Toast Notifications === */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            z-index: 3000;
            transform: translateX(150%);
            transition: transform 0.3s ease;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.error {
            background: var(--error);
        }

        .toast.warning {
            background: var(--warning);
        }

        /* === Quran Reading Theme === */
        .quran-reading-theme {
            background-color: #f8f4e9;
            color: #3a3520;
        }

        .quran-reading-theme .ayah-arabic {
            color: #2a1e08;
        }

        .quran-reading-theme .ayah-translation {
            color: #5a4c30;
        }

        /* ИСПРАВЛЕНИЕ: Кнопка темы чтения Корана теперь видима на белой теме */
        .theme-toggle-quran {
            background: var(--primary-main);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: var(--radius-md);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-left: 1rem;
        }

        .theme-toggle-quran:hover {
            background: var(--primary-dark);
        }

        .bismillah {
            text-align: center;
            font-family: 'Lateef', serif;
            font-size: 2.5rem;
            margin-bottom: 1.5rem;
            padding: 1rem;
            border-bottom: 2px solid var(--accent-gold);
            color: var(--primary-dark);
        }

        body.dark-theme .bismillah {
            color: var(--accent-gold);
        }

        .bookmark-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--accent-gold);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .last-read-indicator {
            position: absolute;
            top: 10px;
            left: 10px;
            background: var(--primary-main);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .quran-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding: 0.5rem;
            background: var(--bg-light);
            border-radius: var(--radius-md);
        }

        body.dark-theme .quran-controls {
            background: var(--border-dark);
        }

        .font-size-control {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .font-size-btn {
            background: var(--primary-main);
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
        }

        .font-size-label {
            font-size: 0.8rem;
            font-weight: 500;
        }

        .warm-light-toggle {
            background: var(--accent-gold);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .warm-light-toggle:hover {
            background: #e6a429;
        }

        .progress-reading {
            margin-top: 1rem;
            padding: 1rem;
            background: var(--bg-light);
            border-radius: var(--radius-md);
        }

        body.dark-theme .progress-reading {
            background: var(--border-dark);
        }

        .progress-reading-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--primary-dark);
        }

        body.dark-theme .progress-reading-title {
            color: var(--accent-gold);
        }

        .progress-reading-text {
            font-size: 0.9rem;
            color: var(--text-secondary-light);
        }

        body.dark-theme .progress-reading-text {
            color: var(--text-secondary-dark);
        }

        /* ИСПРАВЛЕНИЕ: Прогресс-бар для чтения Корана */
        .reading-progress-container {
            margin-top: 1rem;
            padding: 1rem;
            background: var(--bg-light);
            border-radius: var(--radius-md);
        }

        body.dark-theme .reading-progress-container {
            background: var(--border-dark);
        }

        .reading-progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .reading-progress-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--primary-dark);
        }

        body.dark-theme .reading-progress-title {
            color: var(--accent-gold);
        }

        .reading-progress-percent {
            font-size: 1rem;
            font-weight: 700;
            color: var(--primary-dark);
        }

        body.dark-theme .reading-progress-percent {
            color: var(--accent-gold);
        }

        .reading-progress-bar {
            height: 8px;
            background-color: var(--bg-light);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        body.dark-theme .reading-progress-bar {
            background-color: var(--border-dark);
        }

        .reading-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-main), var(--accent-gold));
            border-radius: 10px;
            width: 0%;
            transition: width 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
        }

        .reading-progress-text {
            font-size: 0.8rem;
            color: var(--text-secondary-light);
            margin-top: 0.5rem;
        }

        body.dark-theme .reading-progress-text {
            color: var(--text-secondary-dark);
        }

        /* Audio Player Styles */
        .audio-player {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
            padding: 0.5rem;
            background: var(--bg-light);
            border-radius: var(--radius-sm);
        }

        body.dark-theme .audio-player {
            background: var(--border-dark);
        }

        .audio-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .play-btn {
            background: var(--primary-main);
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .play-btn.playing {
            background: var(--accent-gold);
        }

        .reciter-select {
            background: var(--bg-card-light);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-sm);
            padding: 0.25rem 0.5rem;
            font-size: 0.8rem;
        }

        body.dark-theme .reciter-select {
            background: var(--bg-card-dark);
            border-color: var(--border-dark);
            color: var(--text-primary-dark);
        }

        .ayah-playing {
            background: linear-gradient(135deg, rgba(11, 91, 63, 0.1), rgba(217, 180, 74, 0.05));
            border-radius: var(--radius-sm);
            padding: 0.5rem;
        }

        body.dark-theme .ayah-playing {
            background: linear-gradient(135deg, rgba(11, 91, 63, 0.2), rgba(217, 180, 74, 0.1));
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Home Tab -->
        <div id="home-tab" class="tab-content active">
            <!-- Header -->
            <header class="header">
                <div class="header-top">
                    <div class="logo">
                        <div class="logo-icon">🕌</div>
                        <div class="logo-text">Путь к Рамадану</div>
                    </div>
                    <button class="theme-toggle" id="themeToggle" aria-label="Переключить тему">
                        🌙
                    </button>
                </div>
                
                <div class="countdown-section">
                    <div class="countdown-title">До Рамадана 2026 года осталось:</div>
                    <div class="countdown-timer" id="countdown">88:00:00:00</div>
                    <div class="countdown-subtitle">По расчетам для региона Махачкала</div>
                </div>
            </header>

            <!-- Progress Section -->
            <section class="progress-section fade-in">
                <div class="progress-header">
                    <span class="progress-label">Ваша готовность к Рамадану</span>
                    <span class="progress-percent" id="progressPercent">0%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </section>

            <!-- Today's Task -->
            <section class="task-card fade-in">
                <div class="task-header">
                    <div class="task-badge">СЕГОДНЯШНЯЯ ЗАДАЧА</div>
                    <div class="task-date" id="currentDate"></div>
                </div>
                
                <div class="task-content">
                    <h2 class="task-title" id="taskTitle">Прочитать 1 страницу Корана</h2>
                    <p class="task-description" id="taskDescription">Открой мусхаф и прочитай одну страницу с медленным тажвидом. Постарайтесь понять смысл прочитанного и подумать над аятами.</p>
                    
                    <div class="task-proof">
                        "Читай во имя Господа твоего, Который сотворил все сущее"
                        <span class="task-source">Коран, 96:1 (перевод Э. Кулиева)</span>
                    </div>
                    
                    <div class="task-actions">
                        <div class="task-checkbox" id="taskCheckbox">
                            <div class="checkbox" id="checkbox"></div>
                            <span class="checkbox-label">Отметить выполненным</span>
                        </div>
                        <div class="task-meta">
                            <div class="task-time">⏱ 15 мин</div>
                            <div class="task-difficulty">💪 Легко</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Quick Actions -->
            <section class="quick-actions fade-in">
                <button class="action-button active" data-action="quran" onclick="showTab('quran-tab')">
                    <div class="action-icon">📖</div>
                    <span class="action-text">Коран</span>
                </button>
                <button class="action-button" data-action="prayer" onclick="showTab('prayer-tab')">
                    <div class="action-icon">🕌</div>
                    <span class="action-text">Намаз</span>
                </button>
                <button class="action-button" data-action="azkar" onclick="showTab('dua-tab')">
                    <div class="action-icon">📿</div>
                    <span class="action-text">Азкары</span>
                </button>
                <button class="action-button" data-action="community" onclick="showCommunityNotification()">
                    <div class="action-icon">👥</div>
                    <span class="action-text">Сообщество</span>
                </button>
            </section>

            <!-- Daily Verse -->
            <section class="verse-card fade-in">
                <div class="verse-header">
                    <div class="verse-title">Аят дня</div>
                    <button class="verse-bookmark" aria-label="Добавить в закладки">🔖</button>
                </div>
                <div class="verse-arabic">
                    إِنَّ اللَّهَ وَمَلَائِكَتَهُ يُصَلُّونَ عَلَى النَّبِيِّ يَا أَيُّهَا الَّذِينَ آمَنُوا صَلُّوا عَلَيْهِ وَسَلِّمُوا تَسْلِيمًا
                </div>
                <div class="verse-translation">
                    "Воистину, Аллах и Его ангелы благословляют Пророка. О те, которые уверовали! Благословляйте его и приветствуйте миром."
                </div>
                <div class="verse-source">
                    Коран, 33:56 (перевод Э. Кулиева)
                </div>
            </section>
        </div>

        <!-- Preparation Tab -->
        <div id="preparation-tab" class="tab-content">
            <header class="header">
                <div class="header-top">
                    <div class="logo">
                        <div class="logo-icon">📅</div>
                        <div class="logo-text">12-недельная подготовка</div>
                    </div>
                    <button class="theme-toggle" id="themeToggle2" aria-label="Переключить тему">
                        🌙
                    </button>
                </div>
            </header>

            <div class="week-section" id="week-section">
                <!-- Weeks will be generated dynamically -->
            </div>
        </div>

        <!-- Quran Tab -->
        <div id="quran-tab" class="tab-content">
            <header class="header">
                <div class="header-top">
                    <div class="logo">
                        <div class="logo-icon">📖</div>
                        <div class="logo-text">Священный Коран</div>
                    </div>
                    <button class="theme-toggle" id="themeToggle3" aria-label="Переключить тему">
                        🌙
                    </button>
                </div>
            </header>

            <div class="quran-controls">
                <div class="font-size-control">
                    <span class="font-size-label">Арабский:</span>
                    <button class="font-size-btn" onclick="changeArabicFontSize(-1)">A-</button>
                    <button class="font-size-btn" onclick="changeArabicFontSize(1)">A+</button>
                </div>
                <button class="warm-light-toggle" onclick="toggleWarmLight()">Теплый свет</button>
                <div class="font-size-control">
                    <span class="font-size-label">Перевод:</span>
                    <button class="font-size-btn" onclick="changeTranslationFontSize(-1)">A-</button>
                    <button class="font-size-btn" onclick="changeTranslationFontSize(1)">A+</button>
                </div>
            </div>

            <!-- ИСПРАВЛЕНИЕ: Добавлен прогресс-бар чтения Корана -->
            <div class="reading-progress-container">
                <div class="reading-progress-header">
                    <span class="reading-progress-title">Ваш прогресс чтения Корана</span>
                    <span class="reading-progress-percent" id="quranProgressPercent">0%</span>
                </div>
                <div class="reading-progress-bar">
                    <div class="reading-progress-fill" id="quranProgressFill"></div>
                </div>
                <div class="reading-progress-text" id="reading-progress-text">Вы еще не начали чтение Корана</div>
            </div>

            <div class="quran-section" id="quran-section">
                <!-- Surahs will be loaded dynamically -->
            </div>
        </div>

        <!-- Prayer Tab -->
        <div id="prayer-tab" class="tab-content">
            <header class="header">
                <div class="header-top">
                    <div class="logo">
                        <div class="logo-icon">🕌</div>
                        <div class="logo-text">Время намаза</div>
                    </div>
                    <button class="theme-toggle" id="themeToggle4" aria-label="Переключить тему">
                        🌙
                    </button>
                </div>
            </header>

            <div class="prayer-section">
                <div class="prayer-times">
                    <div class="prayer-header">
                        <h3 class="prayer-title">Сегодняшние намазы</h3>
                        <span class="prayer-location" id="prayer-location">Махачкала</span>
                    </div>
                    <div class="prayer-list" id="prayer-list">
                        <!-- Prayer times will be loaded dynamically -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Community Tab -->
        <div id="community-tab" class="tab-content">
            <header class="header">
                <div class="header-top">
                    <div class="logo">
                        <div class="logo-icon">👥</div>
                        <div class="logo-text">Сообщество</div>
                    </div>
                    <button class="theme-toggle" id="themeToggle5" aria-label="Переключить тему">
                        🌙
                    </button>
                </div>
            </header>

            <div class="community-section">
                <div class="community-card">
                    <h3 class="community-title">Статистика сообщества</h3>
                    <div class="community-stats">
                        <div class="community-stat">
                            <div class="community-stat-value" id="community-users">1,245</div>
                            <div class="community-stat-label">Участников</div>
                        </div>
                        <div class="community-stat">
                            <div class="community-stat-value" id="community-tasks">12,847</div>
                            <div class="community-stat-label">Выполнено задач</div>
                        </div>
                        <div class="community-stat">
                            <div class="community-stat-value" id="community-pages">45,231</div>
                            <div class="community-stat-label">Прочитано страниц</div>
                        </div>
                    </div>
                    <div class="community-actions">
                        <button class="community-button" onclick="showCommunityNotification()">
                            💬 Обсуждения
                        </button>
                        <button class="community-button" onclick="showCommunityNotification()">
                            🏆 Рейтинг
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dua Tab -->
        <div id="dua-tab" class="tab-content">
            <header class="header">
                <div class="header-top">
                    <div class="logo">
                        <div class="logo-icon">📿</div>
                        <div class="logo-text">Дуа и Азкары</div>
                    </div>
                    <button class="theme-toggle" id="themeToggle6" aria-label="Переключить тему">
                        🌙
                    </button>
                </div>
            </header>

            <div class="dua-section" id="dua-section">
                <!-- Duas will be loaded dynamically -->
            </div>
        </div>

        <!-- Profile Tab -->
        <div id="profile-tab" class="tab-content">
            <header class="header">
                <div class="header-top">
                    <div class="logo">
                        <div class="logo-icon">👤</div>
                        <div class="logo-text">Мой профиль</div>
                    </div>
                    <button class="theme-toggle" id="themeToggle7" aria-label="Переключить тему">
                        🌙
                    </button>
                </div>
            </header>

            <div class="profile-section">
                <div class="profile-card">
                    <div class="profile-avatar">🕌</div>
                    <h2 class="profile-name">Муслим</h2>
                    <div class="profile-level">Начинающий • Уровень 1</div>
                    
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="completedTasks">0</div>
                            <div class="stat-label">Задач</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="quranPages">0</div>
                            <div class="stat-label">Страниц</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="streakDays">0</div>
                            <div class="stat-label">Дней подряд</div>
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <h3 class="settings-title">Настройки</h3>
                    
                    <div class="setting-item">
                        <span class="setting-label">Пуш-уведомления</span>
                        <label class="switch">
                            <input type="checkbox" id="notificationsSwitch" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <span class="setting-label">Напоминания о намазе</span>
                        <label class="switch">
                            <input type="checkbox" id="prayerRemindersSwitch" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <span class="setting-label">Тёмная тема</span>
                        <label class="switch">
                            <input type="checkbox" id="darkThemeSwitch">
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <span class="setting-label">Утренние напоминания</span>
                        <label class="switch">
                            <input type="checkbox" id="morningRemindersSwitch" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <span class="setting-label">Вечерние напоминания</span>
                        <label class="switch">
                            <input type="checkbox" id="eveningRemindersSwitch" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <div class="nav-item active" data-tab="home-tab" onclick="showTab('home-tab')">
                <div class="nav-icon">🏠</div>
                <span class="nav-text">Главная</span>
            </div>
            <div class="nav-item" data-tab="preparation-tab" onclick="showTab('preparation-tab')">
                <div class="nav-icon">📅</div>
                <span class="nav-text">Подготовка</span>
            </div>
            <div class="nav-item" data-tab="quran-tab" onclick="showTab('quran-tab')">
                <div class="nav-icon">📖</div>
                <span class="nav-text">Коран</span>
            </div>
            <div class="nav-item" data-tab="dua-tab" onclick="showTab('dua-tab')">
                <div class="nav-icon">📿</div>
                <span class="nav-text">Дуа</span>
            </div>
            <div class="nav-item" data-tab="profile-tab" onclick="showTab('profile-tab')">
                <div class="nav-icon">👤</div>
                <span class="nav-text">Профиль</span>
            </div>
        </nav>
    </div>

    <!-- Modal for Surah Reading -->
    <div class="modal" id="surah-modal">
        <div class="modal-content" id="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="surah-modal-title">Сура Аль-Фатиха</h3>
                <div>
                    <!-- ИСПРАВЛЕНИЕ: Кнопка темы чтения Корана теперь видима на белой теме -->
                    <button class="theme-toggle-quran" id="quranThemeToggle">Приятная тема</button>
                    <button class="modal-close" onclick="closeSurahModal()">×</button>
                </div>
            </div>
            
            <!-- Audio Player Controls -->
            <div class="audio-player" id="audio-player">
                <div class="audio-controls">
                    <button class="play-btn" id="play-btn">▶️</button>
                    <select class="reciter-select" id="reciter-select">
                        <option value="ar.alafasy">Мишари Рашид Аль-Афаси</option>
                        <option value="ar.husary">Махмуд Халиль Аль-Хусари</option>
                        <option value="ar.hudhaify">Али ибн Абдуррахман Аль-Хузейфи</option>
                        <option value="ar.abdulbasit">Абдульбасит Абдуссамад</option>
                    </select>
                </div>
                <span id="current-reciter">Выберите чтеца</span>
            </div>
            
            <div class="surah-content" id="surah-content">
                <!-- Surah content will be loaded here -->
            </div>
            <div class="surah-navigation">
                <button class="nav-button" id="prev-surah" onclick="navigateSurah(-1)">Предыдущая</button>
                <button class="nav-button" id="next-surah" onclick="navigateSurah(1)">Следующая</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <script>
        // Точная дата Рамадана 2026 (18 февраля 2026 по расчетам для Махачкалы)
        const RAMADAN_2026 = new Date('2026-02-18T00:00:00+03:00');
        const TOTAL_DAYS = 88;

        // Глобальные переменные
        let currentProgress = 0;
        let completedTasks = 0;
        let currentTheme = localStorage.getItem('theme') || 'light';
        let dailyTasks = JSON.parse(localStorage.getItem('dailyTasks')) || {};
        let weeklyTasks = JSON.parse(localStorage.getItem('weeklyTasks')) || {};
        let currentSurah = 1;
        let allSurahs = [];
        let notificationInterval;
        let asrReminderSent = false;
        let quranReadingTheme = localStorage.getItem('quranReadingTheme') || 'default';
        let lastReadAyah = JSON.parse(localStorage.getItem('lastReadAyah')) || { surah: 1, ayah: 1 };
        let bookmarks = JSON.parse(localStorage.getItem('quranBookmarks')) || {};
        let arabicFontSize = parseInt(localStorage.getItem('arabicFontSize')) || 32;
        let translationFontSize = parseInt(localStorage.getItem('translationFontSize')) || 16;
        let warmLightEnabled = localStorage.getItem('warmLightEnabled') === 'true';
        let quranProgress = JSON.parse(localStorage.getItem('quranProgress')) || { readAyahs: 0, totalAyahs: 6236 };
        
        // Audio variables
        let currentAudio = null;
        let isPlaying = false;
        let currentAyah = null;
        let currentReciter = 'ar.alafasy';

        // Данные для подготовки
        const preparationData = [
            {
                week: 12,
                title: "Духовная диагностика",
                theme: "Постановка целей и самопроверка",
                tasks: [
                    "Определить 3 главные цели на Рамадан",
                    "Проанализировать прошлые ошибки",
                    "Написать план исправления",
                    "Записать великие милости Аллаха, которыми Он одарил тебя, и размышлять над ними",
                    "Оценить текущий уровень имана",
                    "Определить вредные привычки для исправления",
                    "Начать вести духовный дневник"
                ]
            },
            {
                week: 11,
                title: "Режим сна",
                theme: "Привыкание к раннему пробуждению на фаджр",
                tasks: [
                    "Ложиться до 23:00",
                    "Вставать на фаджр ежедневно",
                    "Читать утренние азкары после фаджр",
                    "Совершать суннат-намазы фаджра",
                    "Планировать дела на день после фаджр",
                    "Изучить дуа перед сном",
                    "Установить сунну перед сном и придерживаться её всю неделю"
                ]
            },
            {
                week: 10,
                title: "Чтение Корана",
                theme: "1 страница в день с пониманием",
                tasks: [
                    "Читать 1 страницу после фаджр",
                    "Изучать тафсир одного аята",
                    "Запоминать один короткий аят",
                    "Размышлять над смыслом прочитанного",
                    "Читать Коран с тажвидом",
                    "Слушать чтение Корана",
                    "Делиться смыслом аята с семьей"
                ]
            },
            {
                week: 9,
                title: "Укрепление намаза",
                theme: "Сосредоточенность и регулярность",
                tasks: [
                    "Совершать все намазы вовремя",
                    "Готовиться к намазу за 5 минут",
                    "Читать дополнительные суннат-намазы",
                    "Улучшать концентрацию в намазе",
                    "Изучать значения читаемого в намазе",
                    "Совершать намаз в джамаате",
                    "Учить новые суры"
                ]
            },
            {
                week: 8,
                title: "Пост по понедельникам и четвергам",
                theme: "Подготовка организма к посту",
                tasks: [
                    "Соблюдать суннат-пост в понедельник",
                    "Соблюдать суннат-пост в четверг",
                    "Правильно питаться в сухур и ифтар",
                    "Увеличивать потребление воды",
                    "Тренировать нафс на сабр: уменьшить зависимость от привычных удовольствий",
                    "Практиковать ранний сухур",
                    "Изучать правила поста"
                ]
            },
            {
                week: 7,
                title: "Финансовая подготовка",
                theme: "Планирование закята и садаки",
                tasks: [
                    "Рассчитать закят аль-фитр",
                    "Составить список нуждающихся",
                    "Подготовить пожертвования для мечети",
                    "Изучить правила закята",
                    "Определить суммы для садаки",
                    "сделать хотя бы один скрытый саддака-поступок",
                    "Изучить благотворительные проекты"
                ]
            },
            {
                week: 6,
                title: "Духовное очищение",
                theme: "Искренность и отказ от показухи",
                tasks: [
                    "Скрывать благие дела от других",
                    "Практиковать искренность в намерениях",
                    "Избегать хвастовства",
                    "Просить Аллаха принять дела",
                    "Размышлять о показухе (рия)",
                    "Совершать тайные пожертвования",
                    "сделать хотя бы один скрытый саддака-поступок"
                ]
            },
            {
                week: 5,
                title: "Укрепление семейных уз",
                theme: "Подготовка семьи к Рамадану",
                tasks: [
                    "Провести семейную беседу о важности Рамадана",
                    "Разработать общие духовные цели семьи на Рамадан",
                    "Изучить важность и пользу поста",
                    "Стабильно читать по джузу в день",
                    "Создать атмосферу поклонения дома",
                    "Изучить пользу таравих-намаза",
                    "Важность ночных выстаиваний"
                ]
            },
            {
                week: 4,
                title: "Интеллектуальная подготовка",
                theme: "Изучение фикха поста и Рамадана",
                tasks: [
                    "Изучить правила поста",
                    "Узнать о действиях, нарушающих пост",
                    "Изучить исключения из поста",
                    "Прочитать о достоинствах Рамадана",
                    "Изучить правила закята аль-фитр",
                    "Узнать о ночи предопределения",
                    "Изучить правила итикафа"
                ]
            },
            {
                week: 3,
                title: "Социальная ответственность",
                theme: "Подготовка к помощи другим",
                tasks: [
                    "Найти нуждающихся для помощи",
                    "Дуа за мусульман во всем мире",
                    "Помочь нуждающимся едой или продуктами",
                    "Посетить больных родственников",
                    "Помочь в мечети",
                    "Примириться с теми, с кем в ссоре",
                    "Простить обиды"
                ]
            },
            {
                week: 2,
                title: "Интенсивное поклонение",
                theme: "Увеличение объема поклонения",
                tasks: [
                    "Увеличить чтение Корана до нескольких джузов",
                    "Добавить дополнительные нафль-намазы",
                    "Увеличить зикра",
                    "Читать больше салаватов",
                    "Совершать тахаджуд-намаз",
                    "Участвовать в коллективных намазах чаще",
                    "Просить прощения"
                ]
            },
            {
                week: 1,
                title: "Финальная подготовка",
                theme: "Последние приготовления к Рамадану",
                tasks: [
                    "Составить расписание на Рамадан",
                    "Завершить все важные дела",
                    "Сделать генеральную уборку дома",
                    "Купить продукты для Рамадана",
                    "Подготовить одежду для мечети",
                    "Настроить будильники для сухура",
                    "Попросить прощения у всех"
                ]
            }
        ];

        // Утренние и вечерние азкары
        const azkarsData = {
            morning: [
                {
                    arabic: "أَصْبَحْنَا وَأَصْبَحَ الْمُلْكُ لِلَّهِ، وَالْحَمْدُ لِلَّهِ، لا إِلَهَ إِلاَّ اللَّهُ وَحْدَهُ لا شَرِيكَ لَهُ",
                    translation: "Мы дожили до утра, и власть принадлежит Аллаху, хвала Аллаху, нет божества, кроме Аллаха, и нет у Него сотоварища",
                    source: "Муслим 2723"
                },
                {
                    arabic: "اللَّهُمَّ بِكَ أَصْبَحْنَا، وَبِكَ أَمْسَيْنَا، وَبِكَ نَحْيَا، وَبِكَ نَمُوتُ وَإِلَيْكَ النُّشُورُ",
                    translation: "О Аллах, с Тобой мы дожили до утра, с Тобой мы дожили до вечера, с Тобой мы живём, с Тобой умираем, и к Тебе воскресение",
                    source: "Ат-Тирмизи 3391"
                },
                {
                    arabic: "اللَّهُمَّ عَافِنِي فِي بَدَنِي، اللَّهُمَّ عَافِنِي فِي سَمْعِي، اللَّهُمَّ عَافِنِي فِي بَصَرِي، لاَ إِلَهَ إِلاَّ أَنْتَ",
                    translation: "О Аллах, даруй мне здоровье в моем теле, о Аллах, даруй мне здоровье в моем слухе, о Аллах, даруй мне здоровье в моем зрении, нет божества, кроме Тебя",
                    source: "Абу Дауд 5090"
                },
                {
                    arabic: "حَسْبِيَ اللَّهُ لاَ إِلَهَ إِلاَّ هُوَ عَلَيْهِ تَوَكَّلْتُ وَهُوَ رَبُّ الْعَرْشِ الْعَظِيمِ",
                    translation: "Достаточно мне Аллаха, нет божества, кроме Него, на Него я уповаю, и Он - Господь великого Трона",
                    source: "Абу Дауд 5081"
                }
            ],
            evening: [
                {
                    arabic: "أَمْسَيْنَا وَأَمْسَى الْمُلْكُ لِلَّهِ، وَالْحَمْدُ لِلَّهِ، لا إِلَهَ إِلاَّ اللَّهُ وَحْدَهُ لا شَرِيكَ لَهُ",
                    translation: "Мы дожили до вечера, и власть принадлежит Аллаху, хвала Аллаху, нет божества, кроме Аллаха, и нет у Него сотоварища",
                    source: "Муслим 2723"
                },
                {
                    arabic: "اللَّهُمَّ بِكَ أَمْسَيْنَا، وَبِكَ أَصْبَحْنَا، وَبِكَ نَحْيَا، وَبِكَ نَمُوتُ وَإِلَيْكَ الْمَصِيرُ",
                    translation: "О Аллах, с Тобой мы дожили до вечера, с Тобой мы дожили до утра, с Тобой мы живём, с Тобой умираем, и к Тебе возвращение",
                    source: "Ат-Тирмизи 3391"
                },
                {
                    arabic: "اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنَ الْكَسَلِ وَالْهَرَمِ وَالْمَأْثَمِ وَالْمَغْرَمِ",
                    translation: "О Аллах, поистине, я прибегаю к Тебе от лени, старости, греха и долгов",
                    source: "Бухари 6363"
                },
                {
                    arabic: "اللَّهُمَّ إِنِّي أَسْأَلُكَ خَيْرَ هَذِهِ اللَّيْلَةِ وَأَعُوذُ بِكَ مِنْ شَرِّ هَذِهِ اللَّيْلَةِ",
                    translation: "О Аллах, я прошу у Тебя блага этой ночи и прибегаю к Тебе от зла этой ночи",
                    source: "Абу Дауд 5046"
                }
            ]
        };

        // === ОСНОВНЫЕ ФУНКЦИИ НАВИГАЦИИ ===

        function showTab(tabId) {
            // Скрыть все вкладки
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Показать выбранную вкладку
            document.getElementById(tabId).classList.add('active');
            
            // Обновить навигацию
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
            
            // Сброс прокрутки для PWA
            setTimeout(() => {
                const activeTab = document.getElementById(tabId);
                if (activeTab) {
                    activeTab.scrollTop = 0;
                }
            }, 50);
            
            // Обновить прогресс чтения при открытии вкладки Корана
            if (tabId === 'quran-tab') {
                updateReadingProgress();
            }
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast ' + type;
            toast.classList.add('show');
            
            // Вибрация при уведомлении
            if (navigator.vibrate) {
                navigator.vibrate(200);
            }
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function showNotification(message, vibrate = true) {
            // Проверяем разрешение на уведомления
            if ('Notification' in window && Notification.permission === 'granted') {
                const notification = new Notification('Путь к Рамадану', {
                    body: message,
                    icon: 'icons/icon-192.png',
                    badge: 'icons/icon-192.png',
                    tag: 'ramadan-notification',
                    requireInteraction: true
                });
                
                // Вибрация при уведомлении
                if (vibrate && navigator.vibrate) {
                    navigator.vibrate([200, 100, 200]);
                }
                
                // Закрыть уведомление через 5 секунд
                setTimeout(() => {
                    notification.close();
                }, 5000);
            }
            showToast(message, 'warning');
        }

        function showCommunityNotification() {
            showNotification('Раздел "Сообщество" находится в разработке!', true);
        }

        // === ИНИЦИАЛИЗАЦИЯ ПРИЛОЖЕНИЯ ===

        document.addEventListener('DOMContentLoaded', function() {
            initApp();
        });

        function initApp() {
            setupTheme();
            setupCountdown();
            setupEventListeners();
            setupServiceWorker();
            updateCurrentDate();
            updateStats();
            loadPreparationData();
            loadQuranData();
            loadPrayerTimes();
            loadAzkarsData();
            updateDailyTask();
            calculateProgress();
            setupNotifications();
            requestNotificationPermission();
            updateFontSizes();
            setupWarmLight();
            updateQuranProgress();
            setupAudioControls();
        }

        function setupTheme() {
            const darkThemeSwitch = document.getElementById('darkThemeSwitch');
            if (currentTheme === 'dark') {
                document.body.classList.add('dark-theme');
                document.querySelectorAll('.theme-toggle').forEach(toggle => {
                    toggle.textContent = '☀️';
                });
                if (darkThemeSwitch) darkThemeSwitch.checked = true;
            } else {
                document.body.classList.remove('dark-theme');
                document.querySelectorAll('.theme-toggle').forEach(toggle => {
                    toggle.textContent = '🌙';
                });
                if (darkThemeSwitch) darkThemeSwitch.checked = false;
            }
        }

        function setupCountdown() {
            function updateCountdown() {
                const now = new Date();
                const diff = RAMADAN_2026 - now;

                if (diff > 0) {
                    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((diff % (1000 * 60)) / 1000);

                    document.getElementById('countdown').textContent = 
                        `${days.toString().padStart(2, '0')}:${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                } else {
                    document.getElementById('countdown').textContent = "Рамадан наступил!";
                }
            }

            updateCountdown();
            setInterval(updateCountdown, 1000);
        }

        function setupEventListeners() {
            // Переключение темы
            document.querySelectorAll('.theme-toggle').forEach(toggle => {
                toggle.addEventListener('click', toggleTheme);
            });

            // Отметка задачи как выполненной
            document.getElementById('taskCheckbox').addEventListener('click', toggleMainTask);

            // Переключение тёмной темы через switch
            const darkThemeSwitch = document.getElementById('darkThemeSwitch');
            if (darkThemeSwitch) {
                darkThemeSwitch.addEventListener('change', function() {
                    if (this.checked) {
                        currentTheme = 'dark';
                    } else {
                        currentTheme = 'light';
                    }
                    localStorage.setItem('theme', currentTheme);
                    setupTheme();
                });
            }

            // Настройки уведомлений
            const notificationsSwitch = document.getElementById('notificationsSwitch');
            if (notificationsSwitch) {
                notificationsSwitch.addEventListener('change', function() {
                    if (this.checked) {
                        requestNotificationPermission();
                    } else {
                        // Отключить уведомления
                        if (notificationInterval) {
                            clearInterval(notificationInterval);
                        }
                    }
                });
            }

            // Предотвращение масштабирования
            document.addEventListener('gesturestart', function(e) {
                e.preventDefault();
            });

            document.addEventListener('touchmove', function(e) {
                if (e.scale !== 1) {
                    e.preventDefault();
                }
            }, { passive: false });

            // Закрытие модального окна при клике вне его
            document.getElementById('surah-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeSurahModal();
                }
            });

            // Закрытие модального окна при клике на пустое место
            document.getElementById('modal-content').addEventListener('click', function(e) {
                e.stopPropagation();
            });
            
            // Закрытие модального окна при клике на аяты (пустое место)
            document.getElementById('surah-content').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeSurahModal();
                }
            });

            // Переключение темы чтения Корана
            document.getElementById('quranThemeToggle').addEventListener('click', toggleQuranReadingTheme);
        }

        function setupAudioControls() {
            const playBtn = document.getElementById('play-btn');
            const reciterSelect = document.getElementById('reciter-select');
            
            playBtn.addEventListener('click', toggleAudio);
            reciterSelect.addEventListener('change', function() {
                currentReciter = this.value;
                document.getElementById('current-reciter').textContent = this.options[this.selectedIndex].text;
                if (isPlaying) {
                    stopAudio();
                    playAyah(currentAyah);
                }
            });
        }

        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            localStorage.setItem('theme', currentTheme);
            setupTheme();
        }

        function toggleQuranReadingTheme() {
            const modalContent = document.getElementById('modal-content');
            const toggleButton = document.getElementById('quranThemeToggle');
            
            if (quranReadingTheme === 'default') {
                modalContent.classList.add('quran-reading-theme');
                toggleButton.textContent = 'Обычная тема';
                quranReadingTheme = 'pleasant';
            } else {
                modalContent.classList.remove('quran-reading-theme');
                toggleButton.textContent = 'Приятная тема';
                quranReadingTheme = 'default';
            }
            
            localStorage.setItem('quranReadingTheme', quranReadingTheme);
        }

        function toggleWarmLight() {
            warmLightEnabled = !warmLightEnabled;
            localStorage.setItem('warmLightEnabled', warmLightEnabled);
            
            const quranTab = document.getElementById('quran-tab');
            const toggleButton = document.querySelector('.warm-light-toggle');
            
            if (warmLightEnabled) {
                quranTab.classList.add('quran-reading-theme');
                toggleButton.textContent = 'Обычный свет';
                toggleButton.style.background = '#1C7A5C';
            } else {
                quranTab.classList.remove('quran-reading-theme');
                toggleButton.textContent = 'Теплый свет';
                toggleButton.style.background = '';
            }
            
            showToast(warmLightEnabled ? 'Теплый свет включен' : 'Теплый свет выключен');
        }

        function setupWarmLight() {
            const quranTab = document.getElementById('quran-tab');
            const toggleButton = document.querySelector('.warm-light-toggle');
            
            if (warmLightEnabled) {
                quranTab.classList.add('quran-reading-theme');
                toggleButton.textContent = 'Обычный свет';
                toggleButton.style.background = '#1C7A5C';
            }
        }

        function changeArabicFontSize(delta) {
            arabicFontSize = Math.max(16, Math.min(48, arabicFontSize + delta));
            localStorage.setItem('arabicFontSize', arabicFontSize);
            updateFontSizes();
            showToast(`Размер арабского шрифта: ${arabicFontSize}px`);
        }

        function changeTranslationFontSize(delta) {
            translationFontSize = Math.max(12, Math.min(24, translationFontSize + delta));
            localStorage.setItem('translationFontSize', translationFontSize);
            updateFontSizes();
            showToast(`Размер перевода: ${translationFontSize}px`);
        }

        function updateFontSizes() {
            document.documentElement.style.setProperty('--arabic-font-size', arabicFontSize + 'px');
            document.documentElement.style.setProperty('--translation-font-size', translationFontSize + 'px');
        }

        function toggleMainTask() {
            const checkbox = document.getElementById('checkbox');
            const isChecked = checkbox.classList.contains('checked');
            const today = new Date().toDateString();
            
            if (!isChecked) {
                checkbox.classList.add('checked');
                dailyTasks[today] = true;
                completedTasks++;
                updateProgress();
                updateStats();
                showToast('Задача выполнена!', 'success');
                localStorage.setItem('dailyTasks', JSON.stringify(dailyTasks));
            } else {
                checkbox.classList.remove('checked');
                dailyTasks[today] = false;
                completedTasks = Math.max(0, completedTasks - 1);
                updateProgress();
                updateStats();
                showToast('Задача отменена', 'warning');
                localStorage.setItem('dailyTasks', JSON.stringify(dailyTasks));
            }
        }

        function toggleTask(taskElement, weekIndex, taskIndex) {
            const isCompleted = taskElement.classList.contains('completed');
            
            if (!isCompleted) {
                taskElement.classList.add('completed');
                if (!weeklyTasks[weekIndex]) weeklyTasks[weekIndex] = [];
                weeklyTasks[weekIndex][taskIndex] = true;
                showToast('Задача выполнена!', 'success');
            } else {
                taskElement.classList.remove('completed');
                if (weeklyTasks[weekIndex]) weeklyTasks[weekIndex][taskIndex] = false;
                showToast('Задача отменена', 'warning');
            }
            
            updateProgress();
            updateStats();
            localStorage.setItem('weeklyTasks', JSON.stringify(weeklyTasks));
            
            // Обновляем отображение прогресса недели
            updateWeekProgress(weekIndex);
        }

        function updateWeekProgress(weekIndex) {
            const weekCard = document.querySelector(`.week-card:nth-child(${weekIndex + 1})`);
            if (weekCard) {
                const completedCount = weeklyTasks[weekIndex] ? 
                    weeklyTasks[weekIndex].filter(task => task).length : 0;
                const progressElement = weekCard.querySelector('.week-progress');
                if (progressElement) {
                    progressElement.textContent = `${completedCount}/7 выполнено`;
                }
            }
        }

        function calculateProgress() {
            // Рассчитываем прогресс на основе выполненных задач
            const dailyTaskCount = Object.keys(dailyTasks).filter(date => dailyTasks[date]).length;
            const weeklyTaskCount = Object.keys(weeklyTasks).reduce((sum, week) => {
                return sum + (weeklyTasks[week] ? weeklyTasks[week].filter(task => task).length : 0);
            }, 0);
            
            // Прогресс рассчитывается только на основе выполненных задач
            const totalTasks = dailyTaskCount + weeklyTaskCount;
            const maxTasks = 88 + (12 * 7); // 88 дней + 12 недель по 7 задач
            
            currentProgress = Math.min((totalTasks / maxTasks) * 100, 100);
            
            updateProgress();
        }

        function updateProgress() {
            const progressFill = document.getElementById('progressFill');
            const progressPercent = document.getElementById('progressPercent');
            
            progressFill.style.width = `${currentProgress}%`;
            progressPercent.textContent = `${Math.round(currentProgress)}%`;
        }

        function updateStats() {
            const dailyTaskCount = Object.keys(dailyTasks).filter(date => dailyTasks[date]).length;
            const weeklyTaskCount = Object.keys(weeklyTasks).reduce((sum, week) => {
                return sum + (weeklyTasks[week] ? weeklyTasks[week].filter(task => task).length : 0);
            }, 0);
            
            document.getElementById('completedTasks').textContent = dailyTaskCount + weeklyTaskCount;
            document.getElementById('quranPages').textContent = Math.floor((dailyTaskCount + weeklyTaskCount) * 1.5);
            
            // Рассчитываем серию выполненных дней подряд
            const dates = Object.keys(dailyTasks).sort();
            let streak = 0;
            let currentDate = new Date();
            
            for (let i = 0; i < 7; i++) {
                const checkDate = new Date(currentDate);
                checkDate.setDate(checkDate.getDate() - i);
                const dateString = checkDate.toDateString();
                
                if (dailyTasks[dateString]) {
                    streak++;
                } else {
                    break;
                }
            }
            
            document.getElementById('streakDays').textContent = streak;
        }

        function updateCurrentDate() {
            const now = new Date();
            const options = { 
                day: 'numeric', 
                month: 'long', 
                year: 'numeric',
                weekday: 'long'
            };
            document.getElementById('currentDate').textContent = 
                now.toLocaleDateString('ru-RU', options);
        }

        function updateDailyTask() {
            const today = new Date().toDateString();
            const checkbox = document.getElementById('checkbox');
            
            // Проверяем, выполнена ли сегодняшняя задача
            if (dailyTasks[today]) {
                checkbox.classList.add('checked');
            } else {
                checkbox.classList.remove('checked');
            }
            
            // Обновляем задачу чтения Корана с учетом прогресса
            const startDate = new Date('2025-11-22'); // Дата начала программы
            const daysPassed = Math.floor((new Date() - startDate) / (1000 * 60 * 60 * 24));
            const pagesToRead = Math.min(daysPassed + 1, 604); // 604 страницы в Коране
            
            document.getElementById('taskTitle').textContent = `Прочитать ${pagesToRead} страниц Корана`;
            document.getElementById('taskDescription').textContent = 
                `Открой мусхаф и прочитай ${pagesToRead} страниц с медленным тажвидом. Постарайтесь понять смысл прочитанного и подумать над аятами.`;
        }

        function updateReadingProgress() {
            const progressText = document.getElementById('reading-progress-text');
            
            if (lastReadAyah.surah && lastReadAyah.ayah) {
                const surah = allSurahs.find(s => s.number === lastReadAyah.surah);
                if (surah) {
                    progressText.textContent = `Вы остановились на суре ${surah.englishName} (${surah.name}), аят ${lastReadAyah.ayah}`;
                } else {
                    progressText.textContent = `Вы остановились на суре ${lastReadAyah.surah}, аят ${lastReadAyah.ayah}`;
                }
            } else {
                progressText.textContent = 'Вы еще не начали чтение Корана';
            }
        }

        function updateQuranProgress() {
            const progressPercent = Math.round((quranProgress.readAyahs / quranProgress.totalAyahs) * 100);
            document.getElementById('quranProgressPercent').textContent = `${progressPercent}%`;
            document.getElementById('quranProgressFill').style.width = `${progressPercent}%`;
            
            const progressText = document.getElementById('reading-progress-text');
            progressText.textContent = `Прочитано ${quranProgress.readAyahs} из ${quranProgress.totalAyahs} аятов (${progressPercent}%)`;
        }

        function loadPreparationData() {
            const weekSection = document.getElementById('week-section');
            weekSection.innerHTML = '';
            
            preparationData.forEach((weekData, weekIndex) => {
                const weekCard = document.createElement('div');
                weekCard.className = 'week-card';
                
                // Подсчитываем выполненные задачи для этой недели
                const completedCount = weeklyTasks[weekIndex] ? 
                    weeklyTasks[weekIndex].filter(task => task).length : 0;
                
                weekCard.innerHTML = `
                    <div class="week-header">
                        <h3 class="week-title">Неделя ${weekData.week}: ${weekData.title}</h3>
                        <span class="week-progress">${completedCount}/${weekData.tasks.length} выполнено</span>
                    </div>
                    <p class="week-theme">${weekData.theme}</p>
                    <div class="tasks-list">
                        ${weekData.tasks.map((task, taskIndex) => {
                            const isCompleted = weeklyTasks[weekIndex] && weeklyTasks[weekIndex][taskIndex];
                            return `
                                <div class="task-item ${isCompleted ? 'completed' : ''}" 
                                     onclick="toggleTask(this, ${weekIndex}, ${taskIndex})">
                                    <div class="task-item-checkbox"></div>
                                    <span class="task-item-text">${task}</span>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
                
                weekSection.appendChild(weekCard);
            });
        }

        async function loadQuranData() {
            const quranSection = document.getElementById('quran-section');
            quranSection.innerHTML = '<div class="loading">Загрузка Корана...</div>';
            
            try {
                // Используем API для получения списка сур
                const response = await fetch('https://api.alquran.cloud/v1/surah');
                const data = await response.json();
                
                if (data.code === 200) {
                    allSurahs = data.data;
                    
                    quranSection.innerHTML = allSurahs.map(surah => {
                        const isBookmarked = bookmarks[surah.number];
                        const isLastRead = lastReadAyah.surah === surah.number;
                        
                        return `
                            <div class="surah-card" onclick="openSurah(${surah.number})">
                                ${isBookmarked ? '<div class="bookmark-indicator">🔖</div>' : ''}
                                ${isLastRead ? '<div class="last-read-indicator">📖</div>' : ''}
                                <div class="surah-number">${surah.number}</div>
                                <div class="surah-info">
                                    <div class="surah-name">${surah.englishName} (${surah.name})</div>
                                    <div class="surah-details">${surah.numberOfAyahs} аятов • ${surah.revelationType === 'Meccan' ? 'Мекканская' : 'Мединская'}</div>
                                </div>
                                <div class="surah-actions">
                                    <button class="surah-action-btn" onclick="event.stopPropagation(); toggleBookmark(${surah.number})">🔖</button>
                                    <button class="surah-action-btn" onclick="event.stopPropagation(); playSurahAudio(${surah.number})">🔊</button>
                                </div>
                            </div>
                        `;
                    }).join('');
                } else {
                    throw new Error('Не удалось загрузить данные Корана');
                }
            } catch (error) {
                console.error('Ошибка загрузки Корана:', error);
                showToast('Ошибка загрузки Корана', 'error');
                // Запасной вариант - статические данные
                loadFallbackQuranData();
            }
        }

        function loadFallbackQuranData() {
            const quranSection = document.getElementById('quran-section');
            const fallbackSurahs = [
                { number: 1, name: "الفاتحة", englishName: "Al-Fatihah", numberOfAyahs: 7, revelationType: "Meccan" },
                { number: 2, name: "البقرة", englishName: "Al-Baqarah", numberOfAyahs: 286, revelationType: "Medinan" },
                { number: 3, name: "آل عمران", englishName: "Ali 'Imran", numberOfAyahs: 200, revelationType: "Medinan" },
                { number: 4, name: "النساء", englishName: "An-Nisa", numberOfAyahs: 176, revelationType: "Medinan" },
                { number: 5, name: "المائدة", englishName: "Al-Ma'idah", numberOfAyahs: 120, revelationType: "Medinan" },
                { number: 9, name: "التوبة", englishName: "At-Tawbah", numberOfAyahs: 129, revelationType: "Medinan" }
            ];
            
            quranSection.innerHTML = fallbackSurahs.map(surah => {
                const isBookmarked = bookmarks[surah.number];
                const isLastRead = lastReadAyah.surah === surah.number;
                
                return `
                    <div class="surah-card" onclick="openSurah(${surah.number})">
                        ${isBookmarked ? '<div class="bookmark-indicator">🔖</div>' : ''}
                        ${isLastRead ? '<div class="last-read-indicator">📖</div>' : ''}
                        <div class="surah-number">${surah.number}</div>
                        <div class="surah-info">
                            <div class="surah-name">${surah.englishName} (${surah.name})</div>
                            <div class="surah-details">${surah.numberOfAyahs} аятов • ${surah.revelationType === 'Meccan' ? 'Мекканская' : 'Мединская'}</div>
                        </div>
                        <div class="surah-actions">
                            <button class="surah-action-btn" onclick="event.stopPropagation(); toggleBookmark(${surah.number})">🔖</button>
                            <button class="surah-action-btn" onclick="event.stopPropagation(); playSurahAudio(${surah.number})">🔊</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        async function openSurah(surahNumber) {
            currentSurah = surahNumber;
            
            try {
                // Загружаем данные суры из API
                const response = await fetch(`https://api.alquran.cloud/v1/surah/${surahNumber}/editions/quran-uthmani,ru.kuliev`);
                const data = await response.json();
                
                if (data.code === 200) {
                    const arabicEdition = data.data.find(edition => edition.edition.identifier === 'quran-uthmani');
                    const translationEdition = data.data.find(edition => edition.edition.identifier === 'ru.kuliev');
                    
                    if (arabicEdition && translationEdition) {
                        const surah = allSurahs.find(s => s.number === surahNumber);
                        
                        document.getElementById('surah-modal-title').textContent = 
                            `Сура ${surah.englishName} (${surah.name})`;
                        
                        const surahContent = document.getElementById('surah-content');
                        surahContent.innerHTML = '';
                        
                        // ИСПРАВЛЕНИЕ: Добавляем тасмию отдельно (кроме суры Ат-Тауба)
                        if (surahNumber !== 9) {
                            const bismillah = document.createElement('div');
                            bismillah.className = 'bismillah';
                            bismillah.textContent = 'بِسْمِ اللَّهِ الرَّحْمَٰنِ الرَّحِيمِ';
                            surahContent.appendChild(bismillah);
                        }
                        
                        // Создаем контейнеры для каждого аята с арабским текстом и переводом
                        for (let i = 0; i < arabicEdition.ayahs.length; i++) {
                            const arabicAyah = arabicEdition.ayahs[i];
                            const translationAyah = translationEdition.ayahs[i];
                            
                            const ayahContainer = document.createElement('div');
                            ayahContainer.className = 'ayah-container';
                            
                            // Помечаем последний прочитанный аят
                            const isLastRead = lastReadAyah.surah === surahNumber && lastReadAyah.ayah === arabicAyah.numberInSurah;
                            
                            // ИСПРАВЛЕНИЕ: Не добавляем тасмию в первый аят
                            ayahContainer.innerHTML = `
                                <div class="ayah-arabic" ${isLastRead ? 'style="border-right: 3px solid var(--accent-gold); padding-right: 10px;"' : ''}
                                    onclick="playAyah(${arabicAyah.numberInSurah}, ${surahNumber})">
                                    ${arabicAyah.text} <span class="ayah-number">${arabicAyah.numberInSurah}</span>
                                </div>
                                <div class="ayah-translation">
                                    <strong>${arabicAyah.numberInSurah}.</strong> ${translationAyah.text}
                                </div>
                                <button class="nav-button" onclick="setLastReadAyah(${surahNumber}, ${arabicAyah.numberInSurah})" style="font-size: 0.8rem; padding: 0.5rem 1rem;">
                                    Отметить как прочитанное
                                </button>
                            `;
                            
                            surahContent.appendChild(ayahContainer);
                        }
                        
                        // Обновляем навигацию
                        document.getElementById('prev-surah').disabled = surahNumber <= 1;
                        document.getElementById('next-surah').disabled = surahNumber >= allSurahs.length;
                        
                        // Применяем сохраненную тему чтения Корана
                        const modalContent = document.getElementById('modal-content');
                        const toggleButton = document.getElementById('quranThemeToggle');
                        
                        if (quranReadingTheme === 'pleasant') {
                            modalContent.classList.add('quran-reading-theme');
                            toggleButton.textContent = 'Обычная тема';
                        } else {
                            modalContent.classList.remove('quran-reading-theme');
                            toggleButton.textContent = 'Приятная тема';
                        }
                        
                        document.getElementById('surah-modal').classList.add('active');
                    } else {
                        throw new Error('Не удалось загрузить текст суры');
                    }
                } else {
                    throw new Error('Не удалось загрузить данные суры');
                }
            } catch (error) {
                console.error('Ошибка загрузки суры:', error);
                showToast('Ошибка загрузки суры', 'error');
            }
        }

        function closeSurahModal() {
            document.getElementById('surah-modal').classList.remove('active');
            stopAudio();
        }

        function navigateSurah(direction) {
            const newSurah = currentSurah + direction;
            if (newSurah >= 1 && newSurah <= allSurahs.length) {
                openSurah(newSurah);
            }
        }

        function toggleBookmark(surahNumber) {
            if (bookmarks[surahNumber]) {
                delete bookmarks[surahNumber];
                showToast(`Закладка для суры ${surahNumber} удалена`);
            } else {
                bookmarks[surahNumber] = true;
                showToast(`Супра ${surahNumber} добавлена в закладки`);
            }
            localStorage.setItem('quranBookmarks', JSON.stringify(bookmarks));
            loadQuranData(); // Перезагружаем список сур для обновления индикаторов
        }

        function setLastReadAyah(surahNumber, ayahNumber) {
            lastReadAyah = { surah: surahNumber, ayah: ayahNumber };
            localStorage.setItem('lastReadAyah', JSON.stringify(lastReadAyah));
            
            // Обновляем прогресс чтения Корана
            const surah = allSurahs.find(s => s.number === surahNumber);
            if (surah) {
                // Рассчитываем количество прочитанных аятов
                let readAyahs = 0;
                for (let i = 1; i < surahNumber; i++) {
                    const prevSurah = allSurahs.find(s => s.number === i);
                    if (prevSurah) {
                        readAyahs += prevSurah.numberOfAyahs;
                    }
                }
                readAyahs += ayahNumber;
                
                quranProgress.readAyahs = readAyahs;
                localStorage.setItem('quranProgress', JSON.stringify(quranProgress));
                updateQuranProgress();
            }
            
            showToast(`Отмечен аят ${ayahNumber} суры ${surahNumber} как прочитанный`);
            loadQuranData(); // Перезагружаем список сур для обновления индикаторов
            updateReadingProgress(); // Обновляем прогресс чтения
        }

        // === АУДИО ФУНКЦИИ ===

        function playAyah(ayahNumber, surahNumber = currentSurah) {
            if (isPlaying && currentAyah === ayahNumber) {
                toggleAudio();
                return;
            }
            
            stopAudio();
            currentAyah = ayahNumber;
            
            // Создаем аудио элемент
            currentAudio = new Audio();
            
            // Формируем URL для API Al Quran Cloud
            const audioUrl = `https://api.alquran.cloud/v1/ayah/${surahNumber}:${ayahNumber}/${currentReciter}`;
            
            // Загружаем информацию об аяте для получения аудио URL
            fetch(audioUrl)
                .then(response => response.json())
                .then(data => {
                    if (data.code === 200 && data.data.audio) {
                        currentAudio.src = data.data.audio;
                        currentAudio.play();
                        
                        // Обновляем UI
                        document.getElementById('play-btn').classList.add('playing');
                        document.getElementById('play-btn').textContent = '⏸️';
                        isPlaying = true;
                        
                        // Подсвечиваем текущий аят
                        highlightCurrentAyah(ayahNumber);
                        
                        // Обработчики событий аудио
                        currentAudio.addEventListener('ended', function() {
                            stopAudio();
                        });
                        
                        currentAudio.addEventListener('error', function() {
                            showToast('Ошибка воспроизведения аята', 'error');
                            stopAudio();
                        });
                    } else {
                        throw new Error('Аудио не найдено');
                    }
                })
                .catch(error => {
                    console.error('Ошибка загрузки аудио:', error);
                    showToast('Ошибка загрузки аудио', 'error');
                });
        }

        function playSurahAudio(surahNumber) {
            // Воспроизводим первый аят суры
            playAyah(1, surahNumber);
        }

        function toggleAudio() {
            if (isPlaying) {
                stopAudio();
            } else if (currentAyah) {
                playAyah(currentAyah, currentSurah);
            } else {
                showToast('Сначала выберите аят для воспроизведения', 'warning');
            }
        }

        function stopAudio() {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
            }
            
            isPlaying = false;
            document.getElementById('play-btn').classList.remove('playing');
            document.getElementById('play-btn').textContent = '▶️';
            
            // Убираем подсветку с текущего аята
            removeAyahHighlight();
        }

        function highlightCurrentAyah(ayahNumber) {
            // Убираем предыдущую подсветку
            removeAyahHighlight();
            
            // Находим контейнер аята и добавляем класс подсветки
            const ayahContainers = document.querySelectorAll('.ayah-container');
            ayahContainers.forEach(container => {
                const ayahArabic = container.querySelector('.ayah-arabic');
                if (ayahArabic && ayahArabic.textContent.includes(ayahNumber)) {
                    container.classList.add('ayah-playing');
                }
            });
        }

        function removeAyahHighlight() {
            const highlightedAyahs = document.querySelectorAll('.ayah-playing');
            highlightedAyahs.forEach(ayah => {
                ayah.classList.remove('ayah-playing');
            });
        }

        async function loadPrayerTimes() {
            const prayerList = document.getElementById('prayer-list');
            prayerList.innerHTML = '<div class="loading">Загрузка времени намазов...</div>';
            
            try {
                // Получаем местоположение пользователя
                const position = await getCurrentPosition();
                const { latitude, longitude } = position.coords;
                
                // Используем API для получения времени намазов
                const today = new Date();
                const dateString = today.toISOString().split('T')[0];
                const response = await fetch(`https://api.aladhan.com/v1/timings/${dateString}?latitude=${latitude}&longitude=${longitude}&method=2`);
                const data = await response.json();
                
                if (data.code === 200) {
                    const timings = data.data.timings;
                    const prayerTimes = [
                        { name: 'Фаджр', time: timings.Fajr, icon: '🌅' },
                        { name: 'Восход', time: timings.Sunrise, icon: '☀️' },
                        { name: 'Зухр', time: timings.Dhuhr, icon: '☀️' },
                        { name: 'Аср', time: timings.Asr, icon: '⛅' },
                        { name: 'Магриб', time: timings.Maghrib, icon: '🌇' },
                        { name: 'Иша', time: timings.Isha, icon: '🌙' }
                    ];
                    
                    updatePrayerList(prayerTimes);
                    
                    // Обновляем местоположение
                    document.getElementById('prayer-location').textContent = data.data.meta.timezone;
                    
                } else {
                    throw new Error('Не удалось получить время намазов');
                }
            } catch (error) {
                console.error('Ошибка загрузки времени намазов:', error);
                showToast('Используется время для Махачкалы', 'warning');
                // Запасной вариант - статические данные для Махачкалы
                loadFallbackPrayerTimes();
            }
        }

        function getCurrentPosition() {
            return new Promise((resolve, reject) => {
                if (!navigator.geolocation) {
                    reject(new Error('Геолокация не поддерживается'));
                }
                navigator.geolocation.getCurrentPosition(resolve, reject, {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 60000
                });
            });
        }

        function loadFallbackPrayerTimes() {
            // Статические данные для Махачкалы
            const prayerTimes = [
                { name: 'Фаджр', time: '05:30', icon: '🌅' },
                { name: 'Восход', time: '07:15', icon: '☀️' },
                { name: 'Зухр', time: '12:30', icon: '☀️' },
                { name: 'Аср', time: '16:00', icon: '⛅' },
                { name: 'Магриб', time: '18:45', icon: '🌇' },
                { name: 'Иша', time: '20:15', icon: '🌙' }
            ];
            
            updatePrayerList(prayerTimes);
        }

        function updatePrayerList(prayerTimes) {
            const prayerList = document.getElementById('prayer-list');
            const now = new Date();
            const currentHour = now.getHours();
            const currentMinutes = now.getMinutes();
            const currentTime = currentHour * 60 + currentMinutes;
            
            prayerList.innerHTML = prayerTimes.map(prayer => {
                const [hours, minutes] = prayer.time.split(':').map(Number);
                const prayerTime = hours * 60 + minutes;
                
                const isActive = currentTime >= prayerTime && currentTime < prayerTime + 30; // Считаем активным в течение 30 минут
                const isCompleted = currentTime > prayerTime;
                
                return `
                    <div class="prayer-item ${isActive ? 'active' : ''}">
                        <div class="prayer-name">
                            <span>${prayer.icon}</span>
                            ${prayer.name}
                        </div>
                        <div class="prayer-time ${isCompleted ? 'prayer-completed' : ''}">
                            ${prayer.time}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function loadAzkarsData() {
            const duaSection = document.getElementById('dua-section');
            
            duaSection.innerHTML = `
                <div class="dua-category">
                    <h3 class="category-title">Утренние азкары</h3>
                    ${azkarsData.morning.map(dua => `
                        <div class="dua-card">
                            <div class="dua-arabic">${dua.arabic}</div>
                            <div class="dua-translation">${dua.translation}</div>
                            <div class="dua-source">${dua.source}</div>
                        </div>
                    `).join('')}
                </div>
                <div class="dua-category">
                    <h3 class="category-title">Вечерние азкары</h3>
                    ${azkarsData.evening.map(dua => `
                        <div class="dua-card">
                            <div class="dua-arabic">${dua.arabic}</div>
                            <div class="dua-translation">${dua.translation}</div>
                            <div class="dua-source">${dua.source}</div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        async function setupServiceWorker() {
            if ('serviceWorker' in navigator) {
                try {
                    const registration = await navigator.serviceWorker.register('./sw.js');
                    console.log('Service Worker зарегистрирован', registration);
                    
                    // ИСПРАВЛЕНИЕ: Автоматическое обновление PWA при изменении кода
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        if (newWorker) {
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // Новый контент доступен, показываем уведомление
                                    showToast('Доступна новая версия приложения. Перезагрузите страницу для обновления.', 'warning');
                                }
                            });
                        }
                    });
                    
                    // Проверяем обновления каждые 24 часа
                    setInterval(() => {
                        registration.update();
                    }, 24 * 60 * 60 * 1000);
                    
                    // Подписка на push-уведомления
                    if ('PushManager' in window) {
                        const subscription = await registration.pushManager.subscribe({
                            userVisibleOnly: true,
                            applicationServerKey: urlBase64ToUint8Array('BEl62iUYgUivxIkv69yViEuiBIa-Ib9-SkvMeAtA3LFgDzkrxZJjSgSnfckjBJuBkr3qBUYIHBQFLXYp5Nksh8U')
                        });
                        
                        console.log('Подписка на push-уведомления:', subscription);
                    }
                } catch (error) {
                    console.log('Ошибка регистрации Service Worker:', error);
                }
            }
        }

        // Вспомогательная функция для преобразования ключа
        function urlBase64ToUint8Array(base64String) {
            const padding = '='.repeat((4 - base64String.length % 4) % 4);
            const base64 = (base64String + padding)
                .replace(/\-/g, '+')
                .replace(/_/g, '/');
            
            const rawData = window.atob(base64);
            const outputArray = new Uint8Array(rawData.length);
            
            for (let i = 0; i < rawData.length; ++i) {
                outputArray[i] = rawData.charCodeAt(i);
            }
            return outputArray;
        }

        function requestNotificationPermission() {
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        showToast('Разрешение на уведомления получено');
                        setupNotifications();
                    }
                });
            } else if (Notification.permission === 'granted') {
                setupNotifications();
            }
        }

        function setupNotifications() {
            // Очищаем предыдущие интервалы
            if (notificationInterval) {
                clearInterval(notificationInterval);
            }
            
            // Проверяем включены ли уведомления
            const notificationsSwitch = document.getElementById('notificationsSwitch');
            if (!notificationsSwitch || !notificationsSwitch.checked) {
                return;
            }
            
            // Запускаем проверку уведомлений каждую минуту
            notificationInterval = setInterval(() => {
                checkPrayerNotifications();
                checkAzkarNotifications();
                checkAsrReminder();
                checkRamadanPreparationReminder();
            }, 60000); // Каждую минуту
            
            // Первоначальная проверка
            checkPrayerNotifications();
            checkAzkarNotifications();
            checkAsrReminder();
            checkRamadanPreparationReminder();
        }

        function checkPrayerNotifications() {
            const now = new Date();
            const currentHour = now.getHours();
            const currentMinutes = now.getMinutes();
            const currentTime = currentHour * 60 + currentMinutes;
            
            // Получаем время намазов
            const prayerItems = document.querySelectorAll('.prayer-item');
            prayerItems.forEach(item => {
                const prayerName = item.querySelector('.prayer-name').textContent.trim();
                const prayerTimeText = item.querySelector('.prayer-time').textContent;
                const [hours, minutes] = prayerTimeText.split(':').map(Number);
                const prayerTime = hours * 60 + minutes;
                
                // Уведомление за 15 минут до намаза
                if (currentTime >= prayerTime - 15 && currentTime < prayerTime - 14) {
                    showNotification(`Намаз ${prayerName} через 15 минут`, true);
                }
                
                // Уведомление о начале намаза
                if (currentTime >= prayerTime && currentTime < prayerTime + 1) {
                    showNotification(`Время намаза ${prayerName}`, true);
                }
            });
        }

        function checkAzkarNotifications() {
            const now = new Date();
            const currentHour = now.getHours();
            
            // Утренние азкары (6-8 утра)
            if (currentHour >= 6 && currentHour < 8) {
                showNotification('Время утренних азкаров', true);
            }
            
            // Вечерние азкары (18-20 вечера)
            if (currentHour >= 18 && currentHour < 20) {
                showNotification('Время вечерних азкаров', true);
            }
        }

        function checkAsrReminder() {
            const now = new Date();
            const currentHour = now.getHours();
            const currentMinutes = now.getMinutes();
            const currentTime = currentHour * 60 + currentMinutes;
            
            // Получаем время намаза Аср
            const asrItem = document.querySelector('.prayer-item:nth-child(4)'); // 4-й элемент - Аср
            if (asrItem) {
                const asrTimeText = asrItem.querySelector('.prayer-time').textContent;
                const [hours, minutes] = asrTimeText.split(':').map(Number);
                const asrTime = hours * 60 + minutes;
                
                // Напоминание о последнем часе Аср (за 1 час до Магриба)
                const maghribItem = document.querySelector('.prayer-item:nth-child(5)'); // 5-й элемент - Магриб
                if (maghribItem) {
                    const maghribTimeText = maghribItem.querySelector('.prayer-time').textContent;
                    const [maghribHours, maghribMinutes] = maghribTimeText.split(':').map(Number);
                    const maghribTime = maghribHours * 60 + maghribMinutes;
                    const lastHourAsr = maghribTime - 60;
                    
                    if (currentTime >= lastHourAsr && currentTime < lastHourAsr + 1 && !asrReminderSent) {
                        showNotification('Последний час намаза Аср! Постарайтесь совершить намаз вовремя', true);
                        asrReminderSent = true;
                    }
                }
            }
        }

        function checkRamadanPreparationReminder() {
            const now = new Date();
            const diff = RAMADAN_2026 - now;
            const daysLeft = Math.floor(diff / (1000 * 60 * 60 * 24));
            
            // Напоминания о продолжении подготовки к Рамадану
            if (daysLeft === 30) {
                showNotification('До Рамадана остался 1 месяц! Продолжайте подготовку', true);
            } else if (daysLeft === 14) {
                showNotification('До Рамадана осталось 2 недели! Увеличьте усилия в подготовке', true);
            } else if (daysLeft === 7) {
                showNotification('До Рамадана осталась 1 неделя! Завершите все приготовления', true);
            } else if (daysLeft === 3) {
                showNotification('До Рамадана осталось 3 дня! Проверьте готовность к посту', true);
            } else if (daysLeft === 1) {
                showNotification('Завтра начинается Рамадан! Да поможет нам Аллах', true);
            }
        }

        // Запрос разрешения на уведомления при загрузке
        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission();
        }
    </script>
</body>
</html>
